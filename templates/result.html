<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hasil Prediksi</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif; /* Terapkan Poppins */
        background-color: #f8f9fa;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .main-content {
        flex-grow: 1;
      }
      .result-card {
        max-width: 700px;
        margin: 50px auto;
        text-align: center;
        padding: 30px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-radius: 10px;
      }
      .progress-bar-container {
        height: 30px;
        border-radius: 0.5rem;
        margin-top: 15px;
        margin-bottom: 20px;
      }
      /* Gaya untuk tombol logout/login */
      .navbar-text strong {
        color: #ffc107; /* Warna kuning untuk username */
      }
      /* DITAMBAHKAN: Gaya untuk merapikan tombol dan efek hover */
      .action-buttons {
        display: flex;
        flex-wrap: wrap; /* Memungkinkan wrap pada layar kecil */
        gap: 10px; /* Jarak antar tombol */
        justify-content: center; /* Pusatkan tombol */
        margin-top: 25px;
        margin-bottom: 10px;
      }

      .action-buttons .btn {
        flex-grow: 1;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .action-buttons .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
      /* AKHIR DITAMBAHKAN */
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="{{ url_for('education') }}">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            class="bi bi-heart-pulse-fill"
            viewBox="0 0 16 16"
          >
            <path
              d="M1.475 9C2.25 10.495 4.542 12 8 12.547v.933a.62.62 0 0 0 .193.447l1.5 1.5a.6.6 0 0 0 .408.173h2.3a.6.6 0 0 0 .408-.173l1.5-1.5a.62.62 0 0 0 .193-.447v-.933c3.458-.547 5.75-2.052 6.525-3.547H1.475ZM8.6 6.55l1.6 4.312a.6.6 0 0 0 .96-.07L13 7.84a.6.6 0 0 0-.25-.992l-2.735-.747-.565-1.42a.6.6 0 0 0-1.092-.09l-1.6 4.312a.6.6 0 0 0-.96.07L4 7.84a.6.6 0 0 0 .25-.992l2.735-.747.565-1.42a.6.6 0 0 0 1.092-.09Z"
            />
          </svg>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('education') }}"
                >Pusat Edukasi</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('check_diabetes_page') }}"
                >Cek Diabetes</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link"
                href="{{ url_for('prediction_history_page') }}"
                >Riwayat</a
              >
            </li>
          </ul>

          <div class="ms-auto d-flex">
            {% if current_user.is_authenticated %}
            <span class="navbar-text text-light me-3">
              Halo, <strong>{{ current_user.username }}</strong>!
            </span>
            <a class="btn btn-outline-light" href="{{ url_for('logout') }}"
              >Logout</a
            >
            {% else %}
            <a class="btn btn-outline-light me-2" href="{{ url_for('login') }}"
              >Login</a
            >
            <a class="btn btn-light" href="{{ url_for('register') }}"
              >Register</a
            >
            {% endif %}
          </div>
        </div>
      </div>
    </nav>
    <div class="container main-content">
      <div class="card result-card">
        <h1 class="card-title mb-4">
          <i class="fa-solid fa-bell me-2 text-warning"></i> Hasil Prediksi
          Risiko Diabetes
        </h1>

        {% if result_error %}
        <div class="alert alert-danger" role="alert">
          <h4 class="alert-heading">❌ Proses Gagal</h4>
          <p>{{ result_error }}</p>
          <hr />
          <p class="mb-0">
            Silakan cek kembali input data Anda atau laporkan kesalahan ini.
          </p>
        </div>
        <div class="action-buttons">
          <a href="{{ url_for('check_diabetes_page') }}" class="btn btn-primary"
            ><i class="fa-solid fa-arrow-left me-2"></i> Kembali ke Form</a
          >
        </div>
        {% else %} {% if prediction == 1 %}
        <div class="alert alert-danger" role="alert">
          <h4 class="alert-heading">
            <i class="fa-solid fa-biohazard me-2"></i> Risiko Tinggi Diabetes
            Ditemukan!
          </h4>
          <p class="mb-0">
            Berdasarkan data yang dimasukkan, hasil prediksi menunjukkan bahwa
            Anda memiliki <strong>risiko tinggi terkena diabetes</strong>.
          </p>
        </div>
        <p class="mt-3">
          Disarankan untuk **segera berkonsultasi** dengan tenaga medis
          profesional untuk pemeriksaan dan saran lebih lanjut.
        </p>
        {% else %}
        <div class="alert alert-success" role="alert">
          <h4 class="alert-heading">
            <i class="fa-solid fa-hand-holding-heart me-2"></i> Risiko Diabetes
            Rendah Ditemukan.
          </h4>
          <p class="mb-0">
            Berdasarkan data yang dimasukkan, hasil prediksi menunjukkan bahwa
            Anda <strong>cenderung tidak menderita diabetes</strong>.
          </p>
        </div>
        <p class="mt-3">
          Tetap pertahankan <strong>gaya hidup sehat</strong> dan lakukan
          pemeriksaan rutin.
        </p>
        {% endif %}

        <hr />

        <h5 class="text-secondary mt-4">
          Tingkat Keyakinan Risiko: {{ risk_level }}
        </h5>

        <p>
          Probabilitas prediksi risiko diabetes:
          <strong>{{ probability }}</strong>
        </p>

        {% set bar_class = 'bg-danger' if probability_raw >= 70 else
        ('bg-warning' if probability_raw >= 50 else ('bg-info' if
        probability_raw >= 30 else 'bg-success')) %}

        <div
          class="progress progress-bar-container"
          role="progressbar"
          aria-label="Risk Probability"
          aria-valuenow="{{ probability_raw|int }}"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          <div
            class="progress-bar {{ bar_class }}"
            style="width: {{ probability_raw }}%"
          ></div>
        </div>
        <hr />

        <h5 class="mt-4 mb-3 text-start text-primary">
          <i class="fa-solid fa-list-check me-2"></i> Data Input untuk Analisis
          (Faktor Kontributor):
        </h5>
        <div class="table-responsive">
          <table class="table table-bordered table-striped text-start">
            <thead class="table-light">
              <tr>
                <th>Parameter</th>
                <th>Nilai Anda</th>
                <th>Keterangan</th>
              </tr>
            </thead>
            <tbody>
              {% for key, value in input_data.items() %}
              <tr>
                <td class="fw-bold">{{ key }}</td>
                <td>{{ "%.3f"|format(value|float) }}</td>
                {% if key in ['Glucose', 'BMI', 'Insulin',
                'DiabetesPedigreeFunction'] %}
                <td class="text-danger">Parameter Medis Utama</td>
                {% elif key == 'Pregnancies' %}
                <td>Hanya untuk Wanita</td>
                {% else %}
                <td>Parameter Umum</td>
                {% endif %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <p class="text-muted text-start small">
          Perhatikan nilai pada **Glukosa** dan **BMI** Anda, ini adalah faktor
          paling sensitif dalam model prediksi kami.
        </p>
        <hr />

        <div class="action-buttons">
          <a href="{{ url_for('check_diabetes_page') }}" class="btn btn-primary"
            ><i class="fa-solid fa-plus me-2"></i> Lakukan Prediksi Baru</a
          >
          <a
            href="{{ url_for('prediction_history_page') }}"
            class="btn btn-secondary"
            ><i class="fa-solid fa-clock-rotate-left me-2"></i> Lihat Riwayat</a
          >
          <a href="{{ url_for('education') }}" class="btn btn-outline-info"
            ><i class="fa-solid fa-book-open me-2"></i> Lihat Edukasi</a
          >
        </div>
        {% endif %}
      </div>
    </div>

    <footer class="footer mt-auto py-3 bg-dark">
      <div class="container">
        <span class="text-white"
          >© 2025 Sistem Prediksi Diabetes | Dibuat dengan Bootstrap</span
        >
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
